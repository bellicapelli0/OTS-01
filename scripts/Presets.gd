extends GridContainer

@onready var synth: Synth = get_tree().get_root().get_node("Synth")



func send_preset(desired_curve):
	synth.start_animation(desired_curve)
	synth.amp.set_value_no_signal(1.0)


func preset_saw():
	var desired_curve = []
	for i in Global.w:
		desired_curve.append(Global.h*(float(i)/Global.w))
	desired_curve[0] = Global.h/2
	desired_curve[Global.w-1] = Global.h/2
	send_preset(desired_curve)
	#$"../../Speaker/Volume".value = min($"../../Speaker/Volume".value, 50)
	

func preset_sqr():
	var desired_curve = []
	for i in Global.w:
		desired_curve.append(0 if i<Global.w/2 else Global.h)
	desired_curve[0] = Global.h/2
	desired_curve[Global.w-1] = Global.h/2
	send_preset(desired_curve)
	#$"../../Speaker/Volume".value = min($"../../Speaker/Volume".value, 50)

func preset_sin():
	var desired_curve = []
	for i in Global.w:
		desired_curve.append((Global.h/2)-(Global.h/2)*sin(float(i)*TAU/Global.w))
	send_preset(desired_curve)

func preset_tri():
	var desired_curve = []
	for i in Global.w:
		if i<= Global.w/4:
			desired_curve.append((Global.h/2)-(Global.h/2)*float(i)/(Global.w/4))
		elif i <= Global.w*3/4:
			desired_curve.append(Global.h*float(i-Global.w/4)/(Global.w/2))
		else:
			desired_curve.append((Global.h)-(Global.h/2.0)*float(i-Global.w*3.0/4.0)/(Global.w/4.0))
	send_preset(desired_curve)
	
func preset_lin():
	var desired_curve = []
	for i in Global.w:
		desired_curve.append(Global.h/2 + randf()*0.001)
	send_preset(desired_curve)
	synth.amp.set_value_no_signal(synth.amp.min_value)
	
func preset_global():
	var desired_curve = []	
	var data = $GlobalButton.get_data()
	var n = len(data)
	for i in Global.w:
		desired_curve.append(-data[int(n*i/Global.w)])
	
	var mmin = desired_curve.min()
	#var mmax = desired_curve.max()
	for x in Global.w:
		desired_curve[x] = remap(desired_curve[x], mmin, 0, 0, Global.h/2)
	send_preset(desired_curve)
	
func preset_weierstrass():
	var weir = [200, 194.015762329102, 191.324584960938, 188.037307739258, 185.566314697266, 186.464935302734, 182.672348022461, 185.571807861328, 181.20524597168, 176.126770019531, 172.5029296875, 167.173919677734, 171.225311279297, 170.985260009766, 173.626327514648, 173.074676513672, 169.978897094727, 171.343643188477, 165.553207397461, 167.355560302734, 169.516830444336, 171.427368164063, 171.572296142578, 163.791320800781, 162.781051635742, 156.586654663086, 153.148773193359, 152.722457885742, 150.445953369141, 152.422744750977, 145.584686279297, 142.009063720703, 137.67106628418, 135.048065185547, 139.833099365234, 139.074981689453, 143.283767700195, 143.479080200195, 143.213348388672, 142.948089599609, 139.128860473633, 145.847778320313, 148.386123657227, 150.876739501953, 151.027099609375, 147.450164794922, 147.625381469727, 141.022552490234, 141.437377929688, 142.359176635742, 142.514450073242, 144.357086181641, 138.01628112793, 136.544982910156, 132.977813720703, 133.637802124023, 137.047149658203, 136.795486450195, 143.359954833984, 142.684387207031, 141.342361450195, 139.447235107422, 139.084823608398, 145.399078369141, 144.182464599609, 146.765350341797, 145.935882568359, 141.681121826172, 138.187042236328, 130.632141113281, 131.662704467773, 129.827667236328, 128.881072998047, 126.780952453613, 118.755218505859, 116.77294921875, 111.031677246094, 109.931549072266, 110.189033508301, 111.099784851074, 115.394821166992, 109.639389038086, 107.696495056152, 105.819343566895, 105.400505065918, 107.639602661133, 105.791603088379, 109.679252624512, 105.919708251953, 100.692207336426, 96.33935546875, 90.4493789672852, 92.1273193359375, 89.5352935791016, 89.5998077392578, 86.5549087524414, 81.2174682617188, 80.5412826538086, 74.6220245361328, 76.3405456542969, 79.4496765136719, 83.3519744873047, 86.2906188964844, 82.5570449829102, 85.8196029663086, 85.1651840209961, 86.8618850708008, 91.3637771606445, 93.9843139648438, 99.6368179321289, 96.1659088134766, 94.7872924804688, 92.4260787963867, 90.4492874145508, 94.678840637207, 93.3009719848633, 95.8540420532227, 94.5819854736328, 92.7256469726563, 91.5787811279297, 87.3878173828125, 93.9181365966797, 97.6243743896484, 101.280479431152, 103.65943145752, 103.105377197266, 106.822479248047, 103.946113586426, 107.590721130371, 112.279479980469, 114.898178100586, 118.266716003418, 113.066368103027, 111.968673706055, 107.941024780273, 106.408966064453, 107.664405822754, 104.394866943359, 107.266159057617, 103.157936096191, 98.6352767944336, 94.5774917602539, 92.0863647460938, 97.3959732055664, 95.9342803955078, 99.0080032348633, 100.207916259766, 98.3151245117188, 98.1840133666992, 94.1801300048828, 99.172966003418, 100.883415222168, 102.49299621582, 103.415489196777, 97.3975524902344, 96.7127227783203, 91.3010635375977, 90.1643524169922, 89.9121475219727, 88.9354934692383, 92.0023880004883, 85.0772247314453, 82.3879547119141, 80.2983322143555, 80.3091659545898, 84.3044891357422, 84.196418762207, 91.3998870849609, 91.7293472290039, 91.2285766601563, 92.4023361206055, 91.841796875, 99.1913909912109, 101.108741760254, 105.595993041992, 106.32633972168, 103.440086364746, 104.87956237793, 99.5034103393555, 101.17943572998, 102.839599609375, 104.963394165039, 106.081817626953, 99.7027130126953, 101.374816894531, 99.0510330200195, 99.6404876708984, 103.362747192383, 105.939277648926, 112.940727233887, 110.343482971191, 111.168823242188, 111.188293457031, 111.46607208252, 117.522171020508, 117.043853759766, 120.795837402344, 118.98038482666, 116.083625793457, 112.989837646484, 105.513259887695, 108.28165435791, 106.685638427734, 105.320755004883, 102.009757995605, 96.2435531616211, 95.4389495849609, 87.6249160766602, 87.8921356201172, 89.5300674438477, 90.4195861816406, 92.5851440429688, 87.1624069213867, 87.491584777832, 84.0938186645508, 83.9356536865234, 86.3488616943359, 84.1475448608398, 87.5901947021484, 82.9074020385742, 78.3380889892578, 72.4162902832031, 67.6229858398438, 69.977294921875, 64.8164215087891, 64.4336547851563, 61.5193328857422, 56.8765716552734, 53.7344055175781, 47.4163970947266, 51.4342346191406, 52.3254089355469, 54.7593536376953, 56.8268280029297, 53.6395263671875, 56.0175323486328, 53.5602111816406, 56.2680053710938, 58.6982421875, 60.6354217529297, 65.6727447509766, 60.2140502929688, 58.1500091552734, 54.9841613769531, 54.0834045410156, 55.2132263183594, 51.9281921386719, 55.8185272216797, 52.6673583984375, 49.0111236572266, 46.3428497314453, 43.7131500244141, 49.0180358886719, 49.2839813232422, 53.4071502685547, 54.3480377197266, 52.9982299804688, 55.2352447509766, 51.5110015869141, 54.7516479492188, 57.1683197021484, 60.1522979736328, 60.6941375732422, 53.7787628173828, 53.5061492919922, 48.3943939208984, 45.2746124267578, 43.9309539794922, 42.1632995605469, 43.8418579101563, 36.1117858886719, 32.17431640625, 28.0724639892578, 25.2250061035156, 27.8006439208984, 26.0523376464844, 29.4806213378906, 28.13427734375, 26.5679321289063, 25.2027435302734, 20.6391143798828, 25.4052886962891, 26.2442626953125, 27.1414642333984, 25.3831024169922, 21.0731964111328, 20.3047637939453, 12.373779296875, 11.3231964111328, 11.5462493896484, 10.9359741210938, 10.9017181396484, 4.37966918945313, 3.64918518066406, 0, 0, 3.64918518066406, 4.37966918945313, 10.9017181396484, 10.9359741210938, 11.5462493896484, 11.3231964111328, 12.373779296875, 20.3047637939453, 21.0731964111328, 25.3831024169922, 27.1414642333984, 26.2442626953125, 25.4052886962891, 20.6391143798828, 25.2027435302734, 26.5679321289063, 28.13427734375, 29.4806213378906, 26.0523376464844, 27.8006439208984, 25.2250061035156, 28.0724639892578, 32.17431640625, 36.1117858886719, 43.8418579101563, 42.1632995605469, 43.9309539794922, 45.2746124267578, 48.3943939208984, 53.5061492919922, 53.7787628173828, 60.6941375732422, 60.1522979736328, 57.1683197021484, 54.7516479492188, 51.5110015869141, 55.2352447509766, 52.9982299804688, 54.3480377197266, 53.4071502685547, 49.2839813232422, 49.0180358886719, 43.7131500244141, 46.3428497314453, 49.0111236572266, 52.6673583984375, 55.8185272216797, 51.9281921386719, 55.2132263183594, 54.0834045410156, 54.9841613769531, 58.1500091552734, 60.2140502929688, 65.6727447509766, 60.6354217529297, 58.6982421875, 56.2680053710938, 53.5602111816406, 56.0175323486328, 53.6395263671875, 56.8268280029297, 54.7593536376953, 52.3254089355469, 51.4342346191406, 47.4163970947266, 53.7344055175781, 56.8765716552734, 61.5193328857422, 64.4336547851563, 64.8164215087891, 69.977294921875, 67.6229858398438, 72.4162902832031, 78.3380889892578, 82.9074020385742, 87.5901947021484, 84.1475448608398, 86.3488616943359, 83.9356536865234, 84.0938186645508, 87.491584777832, 87.1624069213867, 92.5851440429688, 90.4195861816406, 89.5300674438477, 87.8921356201172, 87.6249160766602, 95.4389495849609, 96.2435531616211, 102.009757995605, 105.320755004883, 106.685638427734, 108.28165435791, 105.513259887695, 112.989837646484, 116.083625793457, 118.98038482666, 120.795837402344, 117.043853759766, 117.522171020508, 111.46607208252, 111.188293457031, 111.168823242188, 110.343482971191, 112.940727233887, 105.939277648926, 103.362747192383, 99.6404876708984, 99.0510330200195, 101.374816894531, 99.7027130126953, 106.081817626953, 104.963394165039, 102.839599609375, 101.17943572998, 99.5034103393555, 104.87956237793, 103.440086364746, 106.32633972168, 105.595993041992, 101.108741760254, 99.1913909912109, 91.841796875, 92.4023361206055, 91.2285766601563, 91.7293472290039, 91.3998870849609, 84.196418762207, 84.3044891357422, 80.3091659545898, 80.2983322143555, 82.3879547119141, 85.0772247314453, 92.0023880004883, 88.9354934692383, 89.9121475219727, 90.1643524169922, 91.3010635375977, 96.7127227783203, 97.3975524902344, 103.415489196777, 102.49299621582, 100.883415222168, 99.172966003418, 94.1801300048828, 98.1840133666992, 98.3151245117188, 100.207916259766, 99.0080032348633, 95.9342803955078, 97.3959732055664, 92.0863647460938, 94.5774917602539, 98.6352767944336, 103.157936096191, 107.266159057617, 104.394866943359, 107.664405822754, 106.408966064453, 107.941024780273, 111.968673706055, 113.066368103027, 118.266716003418, 114.898178100586, 112.279479980469, 107.590721130371, 103.946113586426, 106.822479248047, 103.105377197266, 103.65943145752, 101.280479431152, 97.6243743896484, 93.9181365966797, 87.3878173828125, 91.5787811279297, 92.7256469726563, 94.5819854736328, 95.8540420532227, 93.3009719848633, 94.678840637207, 90.4492874145508, 92.4260787963867, 94.7872924804688, 96.1659088134766, 99.6368179321289, 93.9843139648438, 91.3637771606445, 86.8618850708008, 85.1651840209961, 85.8196029663086, 82.5570449829102, 86.2906188964844, 83.3519744873047, 79.4496765136719, 76.3405456542969, 74.6220245361328, 80.5412826538086, 81.2174682617188, 86.5549087524414, 89.5998077392578, 89.5352935791016, 92.1273193359375, 90.4493789672852, 96.33935546875, 100.692207336426, 105.919708251953, 109.679252624512, 105.791603088379, 107.639602661133, 105.400505065918, 105.819343566895, 107.696495056152, 109.639389038086, 115.394821166992, 111.099784851074, 110.189033508301, 109.931549072266, 111.031677246094, 116.77294921875, 118.755218505859, 126.780952453613, 128.881072998047, 129.827667236328, 131.662704467773, 130.632141113281, 138.187042236328, 141.681121826172, 145.935882568359, 146.765350341797, 144.182464599609, 145.399078369141, 139.084823608398, 139.447235107422, 141.342361450195, 142.684387207031, 143.359954833984, 136.795486450195, 137.047149658203, 133.637802124023, 132.977813720703, 136.544982910156, 138.01628112793, 144.357086181641, 142.514450073242, 142.359176635742, 141.437377929688, 141.022552490234, 147.625381469727, 147.450164794922, 151.027099609375, 150.876739501953, 148.386123657227, 145.847778320313, 139.128860473633, 142.948089599609, 143.213348388672, 143.479080200195, 143.283767700195, 139.074981689453, 139.833099365234, 135.048065185547, 137.67106628418, 142.009063720703, 145.584686279297, 152.422744750977, 150.445953369141, 152.722457885742, 153.148773193359, 156.586654663086, 162.781051635742, 163.791320800781, 171.572296142578, 171.427368164063, 169.516830444336, 167.355560302734, 165.553207397461, 171.343643188477, 169.978897094727, 173.074676513672, 173.626327514648, 170.985260009766, 171.225311279297, 167.173919677734, 172.5029296875, 176.126770019531, 181.20524597168, 185.571807861328, 182.672348022461, 186.464935302734, 185.566314697266, 188.037307739258, 191.324584960938, 194.015762329102, 200]
	if len(weir) == Global.w:
		send_preset(weir)
	else:
		var desired_curve = []
		var n = len(weir)
		for i in Global.w:
			desired_curve.append(weir[int(n*i/Global.w)])
		send_preset(weir)


